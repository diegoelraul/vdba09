/* Ok, no es lo mas elegante pero incluyo todo en un unico script */

/* Desde la consola de mysql: SOURCE path_fichero */

DROP DATABASE IF EXISTS DATOSPELICULAS;

CREATE DATABASE DatosPeliculas;
USE DatosPeliculas;

DROP TABLE IF EXISTS USUARIO;
CREATE TABLE USUARIO (
	Id_usuario VARCHAR(40) NOT NULL,
	Password VARCHAR(40),
	Fec_acceso DATE,
	CONSTRAINT PK_Usuario
	PRIMARY KEY(ID_USUARIO)
) ENGINE=MyISAM;

DROP TABLE IF EXISTS PELICULA;
CREATE TABLE PELICULA (
	Titulo VARCHAR(40) NOT NULL,
	Nombre_director VARCHAR(40),
	Apellidos_director VARCHAR(80),
	Idioma VARCHAR (40),
	Coste DOUBLE (9,3),
	Precio DOUBLE (9,3),
	Disponibilidad INT,
	Path_imagen VARCHAR(80) DEFAULT 'vacio',
	CONSTRAINT PK_Pelicula
	PRIMARY KEY (TITULO)
) ENGINE=MyISAM;

DROP TABLE IF EXISTS REPARTO;
CREATE TABLE REPARTO (
	Titulo VARCHAR(40) NOT NULL,
	Nombre VARCHAR(40),
	Apellidos VARCHAR(40),
	Personaje VARCHAR(40),
	CONSTRAINT PK_Reparto
	PRIMARY KEY (Titulo, Nombre, Apellidos),
	INDEX (Titulo),
	FOREIGN KEY (Titulo)
		REFERENCES Pelicula (TITULO)
		ON UPDATE CASCADE ON DELETE CASCADE
) ENGINE=MyISAM;


DROP TABLE IF EXISTS COMPRA;
CREATE TABLE COMPRA (
	Usuario VARCHAR(40) NOT NULL,
	Pelicula VARCHAR(40) NOT NULL,
	fec_compra DATE NOT NULL,
	CONSTRAINT PK_Compra
	PRIMARY KEY (USUARIO, PELICULA, FEC_COMPRA),
	INDEX (Usuario),
	FOREIGN KEY (USUARIO)
		REFERENCES Usuario (ID_USUARIO)
		ON UPDATE CASCADE ON DELETE RESTRICT, 
	INDEX (Pelicula),
	FOREIGN KEY (PELICULA)
		REFERENCES Pelicula (TITULO)
		ON UPDATE CASCADE ON DELETE RESTRICT
) ENGINE=MyISAM;


/* inserciones para las pruebas */
INSERT INTO Usuario VALUES('pepitogrillo37', 'aaaa', '1999-03-22');
INSERT INTO Usuario VALUES('YagoCampeon', 'aaaabbb', '2009-03-21');
INSERT INTO Usuario VALUES('ManolitoGafotas', 'sinpass', '2010-01-03');
INSERT INTO Usuario VALUES('Juanito', 'soytorpe', '2010-01-03');
INSERT INTO Usuario VALUES('AlvaroQueipo', 'comorrr', '2010-01-03');
INSERT INTO Usuario VALUES('Eva83', 'tomatesverdes', '2009-12-31');

INSERT INTO Pelicula VALUES('Abajo el Telon', 'Joan', 'Fris y pedastal', 'Swahili', '2.00', '5.95', '10','vacio');
INSERT INTO Reparto VALUES('Abajo el Telon', 'Mario', 'Moreno', 'Cantiflas');
INSERT INTO Reparto VALUES('Abajo el Telon', 'Christine', 'Martell', 'Pepa');
INSERT INTO Reparto VALUES('Abajo el Telon', 'Beatriz', 'Saavedra', 'Secundario');

INSERT INTO Pelicula VALUES('A, B, C... Manhattan', 'Amir', 'Naderi', 'Spanglish', '1.90', '4.95', '28','vacio');
INSERT INTO Reparto VALUES('A, B, C... Manhattan', 'Maisy', 'Naderi', 'desconocido');
INSERT INTO Reparto VALUES('A, B, C... Manhattan', 'Erin', 'Norris', 'mala');
INSERT INTO Reparto VALUES('A, B, C... Manhattan', 'Sara', 'Paul', 'caballera');

INSERT INTO Pelicula VALUES('Nabonga, el gorila', 'Sam', 'Newfield', 'Frances', '1.90', '4.95', '2','vacio');
INSERT INTO Reparto VALUES('Nabonga, el gorila', 'Julie', 'London', 'Damisela');
INSERT INTO Reparto VALUES('Nabonga, el gorila', 'Fifi', 'D Orsay', 'Gorila');

INSERT INTO Compra VALUES('pepitogrillo37', 'Nabonga, el gorila', '1999-03-22');
INSERT INTO Compra VALUES('YagoCampeon', 'Nabonga, el gorila', '2007-01-03');
INSERT INTO Compra VALUES('Eva83', 'Abajo el Telon', '2007-01-03');
INSERT INTO Compra VALUES('pepitogrillo37', 'Abajo el Telon', '2007-01-03');
INSERT INTO Compra VALUES('AlvaroQueipo', 'A, B, C... Manhattan', '2007-05-03');
INSERT INTO Compra VALUES('AlvaroQueipo', 'Nabonga, el gorila', '2007-05-03');

SELECT * FROM USUARIO;
SELECT * FROM PELICULA;
SELECT * FROM REPARTO;
SELECT * FROM COMPRA;
  
